name: Debug Production EC2 Logs

on: 
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/debug-ec2-logs.yml'

jobs:
  debug-logs:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Docker Logs
        uses: appleboy/ssh-action@v1.2.0
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USER }}
          key: ${{ secrets.EC2_KEY }}
          script: |
            echo "======================================================="
            echo "             DOCKER CONTAINER STATUS"
            echo "======================================================="
            docker ps -a
            
            echo ""
            echo "======================================================="
            echo "             DISCOVERY SERVICE LOGS"
            echo "======================================================="
            docker logs discovery-service --tail 50 || echo "Discovery Service not found"

            echo ""
            echo "======================================================="
            echo "             API GATEWAY LOGS"
            echo "======================================================="
            docker logs api-gateway --tail 50 || echo "API Gateway not found"

            echo ""
            echo "======================================================="
            echo "             STUDENT SERVICE LOGS"
            echo "======================================================="
            docker logs student-service --tail 50 || echo "Student Service not found"

            echo ""
            echo "======================================================="
            echo "             ENROLLMENT SERVICE LOGS"
            echo "======================================================="
            docker logs enrollment-service --tail 50 || echo "Enrollment Service not found"

            echo ""
            echo "======================================================="
            echo "             NOTIFICATION SERVICE LOGS"
            echo "======================================================="
            docker logs notification-service --tail 50 || echo "Notification Service not found"
            
            echo ""
            echo "======================================================="
            echo "             POSTGRES LOGS (DB ERRORS?)"
            echo "======================================================="
            docker logs student-postgres --tail 50 || echo "Postgres not found"
            # End of Logs
