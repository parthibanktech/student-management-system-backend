# Events block defines the parameters that affect connection processing.
events {
    # worker_connections sets the maximum number of simultaneous connections that can be opened by a worker process.
    # 1024 is a common default value.
    worker_connections 1024;
}

# HTTP block defines the parameters for the HTTP server.
http {
    # Upstream block defines a group of servers that can be referenced by the proxy_pass directive.
    # This is used for load balancing or simply defining the backend service.
    upstream api_gateway {
        # Defines the server address and port for the upstream group.
        # 'api-gateway' is the hostname of the service in the Docker network.
        # '8080' is the internal port the api-gateway service is listening on.
        server api-gateway:8080;
    }

    # Server block defines a virtual server.
    server {
        # Listen on port 80 for incoming HTTP requests.
        listen 80;
        
        # server_name defines the domain names that this server block should respond to.
        # 'localhost' means it will respond to requests made to localhost.
        server_name localhost;

        # Location block defines how to process requests for specific URIs.
        # '/' matches all requests.
        location / {
            # proxy_pass forwards the request to the upstream server group defined above (api_gateway).
            proxy_pass http://api_gateway;
            
            # proxy_set_header sets the Host header of the forwarded request to the value of the client's Host header.
            # This is important for the backend to know the original host requested.
            proxy_set_header Host $host;
            
            # proxy_set_header X-Real-IP sets the X-Real-IP header to the client's IP address.
            # This allows the backend to see the real IP of the client, not just the Nginx proxy's IP.
            proxy_set_header X-Real-IP $remote_addr;
            
            # proxy_set_header X-Forwarded-For appends the client's IP to the X-Forwarded-For header.
            # This is a standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy.
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            
            # proxy_set_header X-Forwarded-Proto sets the X-Forwarded-Proto header to the scheme (http or https) of the original request.
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
